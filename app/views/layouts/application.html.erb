<!DOCTYPE html>
<html lang="ja" data-theme="light">
  <head>
    <meta charset="utf-8">
    <title><%= content_for?(:title) ? yield(:title) : "QuoteCanvas" %></title>

    <!-- 表示最適化 -->
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="color-scheme" content="light">
    <meta name="theme-color" content="#F9FAFB">

    <!-- CSS 適用前の瞬間もライト固定にする -->
    <script nonce="<%= content_security_policy_nonce %>">
      (function () {
        var d = document.documentElement;
        d.setAttribute('data-theme', 'light'); // daisyUI v5 対応テーマ
        d.classList.remove('dark');            // Tailwind の dark: を無効化
        d.style.colorScheme = 'light';         // UA コンポーネントもライト
      })();
    </script>

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= yield :head %>

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">

    <%# フォント %>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@600;700&display=swap" rel="stylesheet">

    <%= stylesheet_link_tag "tailwind", "inter-font", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>

    <style nonce="<%= content_security_policy_nonce %>">
      .turbo-progress-bar{ height:3px; background:linear-gradient(90deg,#22d3ee,#f472b6); }
    </style>
  </head>

  <!-- 本文色はテーマ変数に追従させる -->
  <body class="min-h-dvh flex flex-col bg-base-200 text-base-content">
    <%= content_for?(:bg) ? yield(:bg) : render("shared/bg_sky") %>

    <a href="#main"
       class="sr-only focus:not-sr-only focus:fixed focus:top-2 focus:left-2
              focus:bg-base-100 focus:text-base-content focus:px-3 focus:py-2 focus:rounded">
      コンテンツへスキップ
    </a>

    <div class="relative z-10 flex min-h-0 flex-1 flex-col">
      <%= render "shared/header" %>
      <%= render "shared/welcome_banner" %>

      <main id="main" role="main"
            class="container mx-auto w-full max-w-7xl flex-1 px-4 md:px-8 pt-16 md:pt-20 pb-10
                   [padding-bottom:env(safe-area-inset-bottom)]">
        <%= render "shared/flash" %>
        <%= yield %>
      </main>

      <%= render "shared/footer" %>
      <% if user_signed_in? && current_user.show_guide? %>
        <%= render "shared/onboarding_modal" %>
      <% end %>
    </div>

    <%= yield :body_end %>
  </body>
</html>