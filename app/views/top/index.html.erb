<section class="pt-8 sm:pt-10 md:pt-12">
  <div class="container mx-auto max-w-7xl px-4 md:px-8">

    <!-- =========================
         Hero + ライブ・プレイグラウンド
         ========================= -->
    <div class="relative overflow-hidden rounded-3xl gh-glass p-6 sm:p-8 md:p-10 hover-float">
      <div class="pointer-events-none absolute -top-24 -right-24 size-80 rounded-full bg-gradient-to-tr from-amber-200/40 to-rose-200/40 blur-3xl hidden md:block"></div>

      <div class="grid items-start gap-8 sm:gap-10 lg:grid-cols-2">
        <!-- 左：コピー & CTA -->
        <div class="flex flex-col">
          <div class="mb-3 flex flex-wrap items-center gap-2">
            <span class="badge badge-primary">β / MVP</span>
            <span class="badge badge-ghost">プライバシー重視</span>
            <span class="badge badge-ghost">広告なし</span>
          </div>

          <h1 class="gh-underline gh-sparkle font-serif text-fluid-3xl tracking-tight text-balance">
            一節が、記憶になる。
          </h1>

          <p class="content-readable mt-4 font-sans text-[15px] opacity-85 sm:text-base md:text-lg">
            心に刺さった一節を、<b>著者・タイトル</b>と一緒に保存。<br>
            背景・文字色・フォントを<b>自分らしくカスタム</b>して、“言葉のカード”としてコレクション。<br>
            <span class="opacity-80">思考ログで「言葉 → 気づき」の連鎖も辿れます。</span>
          </p>

          <div class="mt-6 flex flex-col gap-3 sm:mt-8 sm:flex-row">
            <% if user_signed_in? %>
              <%= link_to "ダッシュボードへ", dashboard_path, class: "btn btn-primary" %>
              <%= link_to "＋ 一節を記録", new_passage_path, class: "btn btn-outline" %>
            <% else %>
              <%= link_to "無料ではじめる", new_user_registration_path, class: "btn btn-primary" %>
              <%= link_to "ログイン", new_user_session_path, class: "btn btn-outline" %>
            <% end %>
          </div>
          <p class="mt-3 font-sans text-xs opacity-60">登録は1分。広告なし・いつでも削除できます。</p>

          <!-- ベネフィット帯（等高化） -->
          <div class="mt-6 grid grid-cols-3 gap-3 sm:gap-4 md:max-w-3xl">
            <% [
              { title: "秒速保存", body: "最短10秒で完了" },
              { title: "見返したくなる", body: "美しいカード表示" },
              { title: "深まる読書", body: "思考ログで振り返り" }
            ].each do |b| %>
              <div class="min-h-[74px] rounded-xl bg-base-100 p-3 shadow-sm flex flex-col">
                <div class="text-sm font-bold"><%= b[:title] %></div>
                <div class="mt-0.5 text-[13px] opacity-70"><%= b[:body] %></div>
              </div>
            <% end %>
          </div>
        </div>

        <!-- 右：ライブ・プレイグラウンド（固定高さで安定） -->
        <div class="w-full max-w-lg mx-auto lg:justify-self-end self-start">
          <div class="relative overflow-hidden rounded-3xl gh-glass p-4 sm:p-6 md:p-8 self-start">
            <div class="grid gap-4 sm:gap-5">
              <!-- プレビューカード：固定高さ + 行数制限 -->
              <div id="demo-card"
                    class="relative overflow-hidden rounded-2xl border box-border p-4 sm:p-5 qc-demo-h flex flex-col"
                    style="background:#FAF7F0; color:#111827; font-family: var(--font-serif);">
                <div class="absolute inset-0 gh-grain pointer-events-none rounded-2xl"></div>
                <div id="demo-meta" class="mb-1 font-sans text-[11px] opacity-70">作者・書名（任意）</div>
                <div id="demo-quote" class="break-words font-serif font-semibold text-[15px] sm:text-base leading-snug clamp-3" aria-live="polite">
                  「好きな一節をここに打ってみてください」
                </div>
                <button id="demo-random" type="button" class="btn btn-xs btn-ghost mt-auto self-end">
                  ランダム見本
                </button>
              </div>

              <!-- コントロール -->
              <div class="grid gap-3 sm:gap-4">
                <!-- 本文 / メタ -->
                <div class="grid gap-2 sm:grid-cols-2">
                  <label class="input input-bordered flex items-center gap-2">
                    <span class="text-[11px] opacity-70">本文</span>
                    <input id="ctl-quote" type="text" class="grow" placeholder="例）メロスは激怒した。" />
                  </label>
                  <label class="input input-bordered flex items-center gap-2">
                    <span class="text-[11px] opacity-70">著者・書名</span>
                    <input id="ctl-meta" type="text" class="grow" placeholder="例）太宰 治『走れメロス』" />
                  </label>
                </div>

                <!-- 配色プリセット -->
                <div>
                  <div class="mb-1 text-[11px] opacity-70">配色</div>
                  <div class="flex flex-wrap items-center gap-2">
                    <% palettes = [
                      { name:"紙", bg:"#FAF7F0", fg:"#111827" },
                      { name:"夜", bg:"#111827", fg:"#F9FAFB" },
                      { name:"薄紅", bg:"#FDF2F8", fg:"#4A044E" },
                      { name:"翆", bg:"#ECFDF5", fg:"#065F46" },
                      { name:"空", bg:"#DBEAFE", fg:"#1E3A8A" },
                      { name:"生成", bg:"#F3F4F6", fg:"#111827" }
                    ] %>
                    <% palettes.each do |p| %>
                      <button type="button"
                              class="btn btn-sm"
                              data-bg="<%= p[:bg] %>" data-fg="<%= p[:fg] %>">
                        <span class="mr-2 inline-block size-3 rounded-full"
                              style="background:<%= p[:bg] %>; border:1px solid rgba(0,0,0,.08)"></span>
                        <%= p[:name] %>
                      </button>
                    <% end %>
                  </div>
                </div>

                <!-- フォント -->
                <div>
                  <div class="mb-1 text-[11px] opacity-70">フォント</div>
                  <div class="join">
                    <input class="join-item btn btn-sm" type="radio" name="font"
                           aria-label="Serif" data-font="var(--font-serif)" checked>
                    <input class="join-item btn btn-sm" type="radio" name="font"
                           aria-label="Sans"  data-font="var(--font-sans)">
                    <input class="join-item btn btn-sm" type="radio" name="font"
                           aria-label="Mono"  data-font='ui-monospace, SFMono-Regular, Menlo, monospace'>
                  </div>
                </div>

                <!-- すぐ試す -->
                <div class="text-center">
                  <% if user_signed_in? %>
                    <%= link_to "この設定で記録をはじめる →", new_passage_path, class: "link link-primary" %>
                  <% else %>
                    <%= link_to "アカウントを作成して保存する →", new_user_registration_path, class: "link link-primary" %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div><!-- /grid -->
    </div><!-- /hero -->

    <!-- =========================
         How it works（コンパクト安定版）
         ========================= -->
    <section id="how" class="scroll-mt-24 py-12 sm:py-14 md:py-16">
      <h2 class="gh-underline text-center font-serif text-fluid-2xl font-bold">
        使い方はかんたん、でも奥深い
      </h2>
      <p class="mt-2 text-center font-sans opacity-70">
        3ステップで “言葉のカード” が完成
      </p>

      <div class="mt-8 grid gap-6 md:grid-cols-12">
        <!-- ステップ -->
        <ol class="steps steps-vertical md:steps-horizontal md:col-span-7 lg:col-span-8">
          <li class="step step-primary">
            <div class="mt-2">
              <div class="font-bold">一節を入力</div>
              <p class="text-sm opacity-75">本文・著者・タイトルをサッと記録</p>
            </div>
          </li>
          <li class="step step-primary">
            <div class="mt-2">
              <div class="font-bold">書誌を補完</div>
              <p class="text-sm opacity-75">「書籍を検索」で書影や出版情報を取得</p>
            </div>
          </li>
          <li class="step step-primary">
            <div class="mt-2">
              <div class="font-bold">彩って保存</div>
              <p class="text-sm opacity-75">背景・文字色・フォントを選んでカード化</p>
            </div>
          </li>
        </ol>

        <!-- デモ＋箇条書き -->
        <div class="md:col-span-5 lg:col-span-4 space-y-4">
          <div class="relative rounded-xl border overflow-hidden gh-paper">
            <div class="absolute inset-0 gh-grain pointer-events-none rounded-xl"></div>
            <div class="p-4">
              <div class="mb-1 font-sans text-[11px] opacity-70">夏目 漱石『こころ』</div>
              <div class="font-serif font-semibold leading-snug text-[15px] sm:text-base clamp-3">
                「人は弱い。弱さを知るところから、やさしさが始まる。」
              </div>
            </div>
          </div>

          <ul class="space-y-2 text-sm opacity-85">
            <li class="flex items-start gap-2"><span class="status"></span>書籍検索で <span class="font-semibold">書影・出版社・出版年</span> を自動補完</li>
            <li class="flex items-start gap-2"><span class="status"></span><span class="font-semibold">配色プリセット＋自由入力</span> で好きな雰囲気に</li>
            <li class="flex items-start gap-2"><span class="status"></span><span class="font-semibold">思考ログ</span> で気づきが連鎖していく</li>
          </ul>
        </div>
      </div>

      <!-- ミニ統計 -->
      <div class="mt-8 stats stats-vertical sm:stats-horizontal bg-base-100 shadow rounded-2xl w-full overflow-hidden qc-stats">
        <div class="stat">
          <div class="stat-title">最短保存</div>
          <div class="stat-value"><span data-countup="10">10</span> 秒</div>
          <div class="stat-desc opacity-75">本文→保存まで（目安）</div>
        </div>
        <div class="stat">
          <div class="stat-title">配色プリセット</div>
          <div class="stat-value"><span data-countup="6">6</span> 種</div>
          <div class="stat-desc opacity-75">自由指定も対応</div>
        </div>
        <div class="stat">
          <div class="stat-title">書誌連携</div>
          <div class="stat-value">対応</div>
          <div class="stat-desc opacity-75">検索で自動補完</div>
        </div>
      </div>
    </section>

    <!-- =========================
         Features（差別化ポイント）
         ========================= -->
    <section id="features" class="scroll-mt-24 py-12 sm:py-14 md:py-16">
      <h2 class="gh-underline text-center font-serif text-fluid-2xl font-bold">
        なぜ QuoteCanvas なのか
      </h2>
      <p class="mt-2 text-center font-sans opacity-70">メモでは届かない、“見返したくなる” 体験</p>

      <div class="mt-8 grid gap-6 md:grid-cols-3">
        <!-- ★ 修正：オーバーレイは absolute、親に relative -->
        <article class="rounded-2xl gh-surface p-5 sm:p-6 hover-float flex flex-col">
          <div class="text-xl">🎨 カードは“小さな作品”に</div>
          <p class="mt-2 text-sm opacity-80">
            配色プリセットとフォントで、言葉の印象までデザイン。あとから編集もOK。
          </p>
          <div class="relative mt-4 rounded-xl border overflow-hidden">
            <div class="absolute inset-0 gh-grain pointer-events-none"></div>
            <div class="grid place-items-center text-center p-4 "
                 style="background:#FDF2F8;color:#4A044E;font-family:var(--font-serif)">
              <div class="mb-1 font-sans text-[11px] opacity-70">与謝野晶子『みだれ髪』</div>
              <div class="font-semibold leading-relaxed clamp-2">その手をば柔らかにして我に触れよ</div>
            </div>
          </div>
          <ul class="mt-4 list-disc space-y-1 pl-5 text-sm opacity-85">
            <li>プリセット6種＋自由指定（色コードOK）</li>
            <li>フォント：Serif / Sans / Mono</li>
            <li>カードは自動整列＆崩れにくい設計</li>
          </ul>
        </article>

        <article class="rounded-2xl gh-surface p-5 sm:p-6 hover-float">
          <div class="text-xl">🧠 思考ログで “後から効く”</div>
          <p class="mt-2 text-sm opacity-80">
            一節から生まれた気づきや連想を、カードに紐づけて時系列に保存。
          </p>
          <div class="mt-4 rounded-xl border bg-base-100 p-4 space-y-2">
            <div class="flex items-start gap-2"><span class="status"></span><div class="text-sm">“なぜ惹かれた？”を言語化 → 行動のヒントに</div></div>
            <div class="flex items-start gap-2"><span class="status"></span><div class="text-sm">後日見返して理解が深まるサイクル</div></div>
            <div class="flex items-start gap-2"><span class="status"></span><div class="text-sm">ログは自分専用。公開は任意</div></div>
          </div>
          <ul class="mt-4 list-disc space-y-1 pl-5 text-sm opacity-85">
            <li>編集履歴／時系列で変化が追える</li>
            <li>検索・フィルタ（将来拡張）</li>
          </ul>
        </article>

        <article class="rounded-2xl gh-surface p-5 sm:p-6 hover-float">
          <div class="text-xl">🔒 続けやすさとプライバシー</div>
          <p class="mt-2 text-sm opacity-80">
            広告なし。あなたのデータはあなたのもの。削除もエクスポートもいつでも。
          </p>
          <div class="mt-4 grid gap-3">
            <div class="rounded-xl bg-base-100 p-3"><div class="text-sm font-bold">プライベート保存</div><div class="text-sm opacity-75">初期は非公開・共有はワンタップ</div></div>
            <div class="rounded-xl bg-base-100 p-3"><div class="text-sm font-bold">軽快なUI</div><div class="text-sm opacity-75">モバイル最適化・最短手数で保存</div></div>
            <div class="rounded-xl bg-base-100 p-3"><div class="text-sm font-bold">運用透明性</div><div class="text-sm opacity-75">データの扱いを明文化（ポリシー公開）</div></div>
          </div>
          <div class="mt-4">
            <%= link_to "ポリシーを見る →", policy_path, class: "link link-primary" rescue nil %>
          </div>
        </article>
      </div>
    </section>

    <!-- =========================
         Gallery（等高レイアウト版）
         ========================= -->
    <section id="gallery" class="scroll-mt-24 py-12 sm:py-14 md:py-16">
      <div class="flex items-end justify-between gap-3">
        <div>
          <h2 class="gh-underline font-serif text-fluid-2xl font-bold">カード・ギャラリー</h2>
          <p class="mt-2 font-sans opacity-70">“言葉の表情”は、色とフォントで変わる</p>
        </div>
        <button id="gallery-shuffle" class="btn btn-sm btn-ghost">シャッフル</button>
      </div>

      <div id="gallery-grid" class="mt-8 grid gap-5 sm:gap-6 sm:grid-cols-2 lg:grid-cols-3">
        <% samples = [
          {bg:"#FDF2F8", fg:"#4A044E", font:"var(--font-serif)",    meta:"与謝野晶子『みだれ髪』", body:"その手をば柔らかにして我に触れよ"},
          {bg:"#111827", fg:"#F9FAFB", font:"ui-monospace,SFMono-Regular,Menlo,monospace", meta:"太宰 治『走れメロス』", body:"メロスは激怒した。"},
          {bg:"#ECFDF5", fg:"#065F46", font:"var(--font-sans)",      meta:"川端 康成『雪国』", body:"国境の長いトンネルを抜けると雪国であった。"},
          {bg:"#FEF3C7", fg:"#78350F", font:"var(--font-serif)",    meta:"夏目 漱石『草枕』", body:"智に働けば角が立つ。情に棹させば流される。"},
          {bg:"#DBEAFE", fg:"#1E3A8A", font:"var(--font-sans)",      meta:"吉本ばなな『キッチン』", body:"この世で一番好きな場所は台所だ。"},
          {bg:"#F3F4F6", fg:"#111827", font:"var(--font-serif)",     meta:"宮沢 賢治『雨ニモマケズ』", body:"雨ニモマケズ 風ニモマケズ"}
        ] %>
        <% samples.each do |c| %>
          <div class="gallery-item relative overflow-hidden rounded-2xl border p-5 sm:p-6 flex flex-col"
               style="background:<%= c[:bg] %>; color:<%= c[:fg] %>; font-family:<%= c[:font] %>;">
            <div class="absolute inset-0 gh-grain pointer-events-none rounded-2xl"></div>
            <div class="mb-1 font-sans text-[11px] opacity-70"><%= c[:meta] %></div>
            <div class="text-base font-semibold leading-relaxed sm:text-lg break-words clamp-3"><%= c[:body] %></div>
            <div class="mt-auto"></div>
          </div>
        <% end %>
      </div>
    </section>

    <!-- =========================
         Use Cases
         ========================= -->
    <section id="usecases" class="scroll-mt-24 py-12 sm:py-14 md:py-16">
      <h2 class="gh-underline text-center font-serif text-fluid-2xl font-bold">使いどころ、いろいろ</h2>
      <p class="mt-2 text-center font-sans opacity-70">あなたのワークフローにぴったりハマる3例</p>

      <div class="mx-auto mt-8 grid max-w-5xl gap-5 sm:gap-6 md:grid-cols-3">
        <article class="rounded-2xl gh-surface p-5 sm:p-6 hover-float flex flex-col min-h-[230px]">
          <header class="text-lg font-bold">📚 読書メモを“作品化”</header>
          <ul class="mt-2 list-disc pl-5 text-sm opacity-85 space-y-1">
            <li>一節を保存 → 配色＆フォントでカード化</li>
            <li>気づきを追記して理解を深める</li>
            <li>後で並べて眺め、比較・発見に</li>
          </ul>
          <div class="mt-auto pt-3"><a href="#gallery" class="link link-primary">ギャラリーを見る →</a></div>
        </article>

        <article class="rounded-2xl gh-surface p-5 sm:p-6 hover-float flex flex-col min-h-[230px]">
          <header class="text-lg font-bold">📝 研究・引用の整理</header>
          <ul class="mt-2 list-disc pl-5 text-sm opacity-85 space-y-1">
            <li>書誌情報を検索で補完して正確に</li>
            <li>タグでテーマ横断の引用集に</li>
            <li>発表用にカードを書き出し（将来）</li>
          </ul>
          <div class="mt-auto pt-3"><a href="#how" class="link link-primary">使い方を確認 →</a></div>
        </article>

        <article class="rounded-2xl gh-surface p-5 sm:p-6 hover-float flex flex-col min-h-[230px]">
          <header class="text-lg font-bold">🎯 クリエイティブの種に</header>
          <ul class="mt-2 list-disc pl-5 text-sm opacity-85 space-y-1">
            <li>心に刺さった一節からアイデア発火</li>
            <li>思考ログで発想の連鎖を可視化</li>
            <li>色でムードボード的に並べ替え</li>
          </ul>
          <div class="mt-auto pt-3"><a href="#features" class="link link-primary">特徴を読む →</a></div>
        </article>
      </div>
    </section>

    <!-- =========================
         FAQ
         ========================= -->
    <section id="faq" class="scroll-mt-24 py-12 sm:py-14 md:py-16">
      <h2 class="gh-underline text-center font-serif text-fluid-2xl font-bold">よくある質問</h2>
      <div class="mx-auto mt-6 max-w-3xl space-y-3">
        <% faqs = [
          {q:"データは公開されますか？", a:"初期設定は非公開です。共有は任意で、いつでも取り消せます。"},
          {q:"広告は出ますか？", a:"出ません。読みやすさと集中を大切にしています。"},
          {q:"スマホでも使えますか？", a:"もちろん。片手で素早く保存できるUIです。"},
          {q:"後から編集できますか？", a:"カードの色・フォント、メモ、タグなどを編集できます。"}
        ] %>
        <% faqs.each do |f| %>
          <details class="rounded-2xl gh-glass p-5">
            <summary class="cursor-pointer text-lg font-bold"><%= f[:q] %></summary>
            <p class="mt-2 font-sans opacity-80"><%= f[:a] %></p>
          </details>
        <% end %>
      </div>
    </section>

    <!-- =========================
         CTA（締め）
         ========================= -->
    <section class="py-12 sm:py-14 md:py-16">
      <div class="hover-float rounded-3xl bg-gradient-to-r from-primary to-secondary p-6 text-center text-primary-content shadow-xl sm:p-8 md:p-10">
        <h2 class="text-balance font-serif text-3xl font-extrabold tracking-tight md:text-4xl">さぁ、一節をカードにしよう。</h2>
        <p class="mt-2 font-sans opacity-90">言葉を集める。自分の色で、記憶にする。</p>
        <div class="mt-6 flex flex-col justify-center gap-3 sm:flex-row">
          <% if user_signed_in? %>
            <%= link_to "ダッシュボードへ", dashboard_path, class: "btn btn-secondary" %>
            <%= link_to "＋ 一節を記録", new_passage_path, class: "btn btn-ghost" %>
          <% else %>
            <%= link_to "無料で始める", new_user_registration_path, class: "btn btn-secondary" %>
            <%= link_to "ログイン", new_user_session_path, class: "btn btn-ghost" %>
          <% end %>
        </div>
        <p class="mt-3 font-sans text-xs opacity-80">データはあなた専用。共有は任意です。</p>
      </div>
    </section>

  </div>
</section>

<!-- ====== ページ下部：最小JS（CSP nonce付き） ====== -->
<script nonce="<%= content_security_policy_nonce %>">
  (function () {
    // -------- Playground ----------
    var card = document.getElementById('demo-card');
    if (card) {
      var q  = document.getElementById('ctl-quote');
      var m  = document.getElementById('ctl-meta');
      var dq = document.getElementById('demo-quote');
      var dm = document.getElementById('demo-meta');

      q && q.addEventListener('input', function(){
        dq.textContent = this.value || "「好きな一節をここに打ってみてください」";
      });
      m && m.addEventListener('input', function(){
        dm.textContent = this.value || "作者・書名（任意）";
      });

      // palette buttons
      document.querySelectorAll('[data-bg][data-fg]').forEach(function(btn){
        btn.addEventListener('click', function(){
          card.style.background = this.dataset.bg;
          card.style.color = this.dataset.fg;
        });
      });

      // font radios
      document.querySelectorAll('input[name="font"][data-font]').forEach(function(r){
        r.addEventListener('change', function(){
          if (this.checked) {
            card.style.fontFamily = this.dataset.font;
            dq.style.fontFamily   = this.dataset.font;
          }
        });
      });

      // ランダム見本
      var randomBtn = document.getElementById('demo-random');
      var samples = [
        { meta:"太宰 治『走れメロス』", quote:"メロスは激怒した。", bg:"#111827", fg:"#F9FAFB", font:'ui-monospace, SFMono-Regular, Menlo, monospace' },
        { meta:"川端 康成『雪国』",     quote:"国境の長いトンネルを抜けると雪国であった。", bg:"#ECFDF5", fg:"#065F46", font:'var(--font-sans)' },
        { meta:"与謝野晶子『みだれ髪』", quote:"その手をば柔らかにして我に触れよ", bg:"#FDF2F8", fg:"#4A044E", font:'var(--font-serif)' },
      ];
      randomBtn && randomBtn.addEventListener('click', function(){
        var s = samples[Math.floor(Math.random()*samples.length)];
        card.style.background = s.bg; card.style.color = s.fg;
        card.style.fontFamily = s.font; dq.style.fontFamily = s.font;
        dm.textContent = s.meta; dq.textContent = s.quote;
      });
    }

    // -------- Stats：CountUp ----------
    var els = document.querySelectorAll('[data-countup]');
    if ('IntersectionObserver' in window && els.length) {
      var once = new WeakSet();
      var io = new IntersectionObserver(function(entries){
        entries.forEach(function(e){
          if (!e.isIntersecting || once.has(e.target)) return;
          once.add(e.target);
          var el = e.target, end = parseInt(el.dataset.countup, 10) || 0;
          var start = 0, dur = 800, t0 = performance.now();
          function tick(t){
            var p = Math.min(1, (t - t0) / dur);
            var val = Math.floor(start + (end - start) * p);
            el.textContent = val;
            if (p < 1) requestAnimationFrame(tick);
          }
          requestAnimationFrame(tick);
        });
      }, {threshold: .3});
      els.forEach(function(el){ io.observe(el); });
    }

    // -------- Gallery：シャッフル ----------
    var grid = document.getElementById('gallery-grid');
    var shuffleBtn = document.getElementById('gallery-shuffle');
    shuffleBtn && shuffleBtn.addEventListener('click', function(){
      if (!grid) return;
      var items = Array.from(grid.querySelectorAll('.gallery-item'));
      for (var i = items.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        grid.appendChild(items[j]);
        items.splice(j, 1);
      }
      this.blur();
    });
  })();
</script>